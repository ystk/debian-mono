From: Markus Koschany <apo@debian.org>
Date: Thu, 1 Nov 2018 17:41:20 +0100
Subject: CVE-2009-0689

See also http://www.mono-project.com/docs/about-mono/vulnerabilities/

Origin: https://gist.github.com/directhex/01e853567fd2cc74ed39
---
 mono/utils/strtod.c | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/mono/utils/strtod.c b/mono/utils/strtod.c
index d7b9934..c834c3d 100644
--- a/mono/utils/strtod.c
+++ b/mono/utils/strtod.c
@@ -533,7 +533,7 @@ Balloc
 #endif
 
 	ACQUIRE_DTOA_LOCK(0);
-	if ((rv = freelist[k])) {
+	if (k <= Kmax && (rv = freelist[k])) {
 		freelist[k] = rv->next;
 		}
 	else {
@@ -570,10 +570,14 @@ Bfree
 	free (v);
 #else
 	if (v) {
-		ACQUIRE_DTOA_LOCK(0);
-		v->next = freelist[v->k];
-		freelist[v->k] = v;
-		FREE_DTOA_LOCK(0);
+		if (v->k > Kmax)
+			free((void*)v);
+		else {
+			ACQUIRE_DTOA_LOCK(0);
+			v->next = freelist[v->k];
+			freelist[v->k] = v;
+			FREE_DTOA_LOCK(0);
+		}
 	}
 #endif
 }
